# ТОЧНЫЕ НАТИВНЫЕ ИНТЕРВАЛЫ - Практическое руководство

## Откуда данные?

✅ **Извлечено напрямую из SPK файлов** через `calceph_inspector.exe` (CALCEPH 4.0.1)
❌ **НЕ из документации** JPL или ИПА РАН

```powershell
# Извлечение точных интервалов
vendor/calceph-4.0.1/install/bin/calceph_inspector.exe data/ephemerides/jpl/de431/de431_part-1.bsp
vendor/calceph-4.0.1/install/bin/calceph_inspector.exe data/ephemerides/epm/2021/spice/epm2021.bsp
```

---

## Сравнительная таблица

| Тело         | DE431 (Chebyshev) | EPM2021 (Hermite) | Рекомендация | Обоснование                          |
|--------------|-------------------|-------------------|--------------|--------------------------------------|
| **Moon**     | 4 дня             | **2 дня**         | EPM (2d)     | Улучшенные LLR, выше точность        |
| **Sun**      | 16 дней           | **2 дня**         | EPM (2d)     | EPM детальнее                        |
| **Earth**    | 4 дня             | **2 дня**         | EPM (2d)     | EPM детальнее                        |
| **EMB**      | 16 дней           | **2 дня**         | EPM (2d)     | EPM ГОРАЗДО детальнее                |
| **Mercury**  | **8 дней**        | 5 дней            | DE431 (8d)   | Быстрое движение, DE достаточно      |
| **Venus**    | **16 дней**       | 20 дней           | DE431 (16d)  | DE детальнее                         |
| **Mars**     | **32 дня**        | 50 дней           | DE431 (32d)  | DE детальнее                         |
| **Jupiter**  | **32 дня**        | 100 дней          | DE431 (32d)  | DE ГОРАЗДО детальнее                 |
| **Saturn**   | **32 дня**        | 300 дней          | DE431 (32d)  | DE ГОРАЗДО детальнее                 |
| **Uranus**   | **32 дня**        | 400 дней          | DE431 (32d)  | DE ГОРАЗДО детальнее                 |
| **Neptune**  | **32 дня**        | 500 дней          | DE431 (32d)  | DE ГОРАЗДО детальнее                 |
| **Pluto**    | **32 дня**        | 600 дней (!)      | DE431 (32d)  | DE ГОРАЗДО детальнее (EPM экономит)  |

### Уникальные тела EPM2021

| Тело                | Интервал  | Доступность     | Применение                      |
|---------------------|-----------|-----------------|----------------------------------|
| **Ceres**           | 100 дней  | Только EPM      | Астрологические расчёты          |
| **Pallas**          | 100 дней  | Только EPM      | Астрологические расчёты          |
| **Vesta**           | 100 дней  | Только EPM      | Астрологические расчёты          |
| **Iris**            | 100 дней  | Только EPM      | Астрологические расчёты          |
| **Bamberga**        | 100 дней  | Только EPM      | Астрологические расчёты          |
| **Sedna (TNO)**     | 100 дней  | Только EPM      | Исследования дальних TNO         |
| **Haumea (dwarf)**  | 100 дней  | Только EPM      | Карликовые планеты               |
| **Eris (dwarf)**    | 100 дней  | Только EPM      | Карликовые планеты               |
| **Makemake (dwarf)**| 100 дней  | Только EPM      | Карликовые планеты               |
| **Pluto-Charon Bary**| 5 дней   | Только EPM      | Система Плутона                  |

---

## Оптимальные профили конвертации

### Профиль 1: "Hybrid Optimal" (гибридный)

**Стратегия**: Использовать лучшее из обоих эфемерид

```json
{
  "profile": "hybrid_optimal",
  "sources": {
    "inner_bodies": "epm2021",  // Moon, Sun, Earth, EMB
    "planets": "de431",          // Mercury-Pluto
    "unique": "epm2021"          // Asteroids, TNO
  },
  "intervals": {
    "10": 2,   // Sun (EPM)
    "301": 2,  // Moon (EPM)
    "399": 2,  // Earth (EPM)
    "3": 2,    // EMB (EPM)
    "1": 8,    // Mercury (DE431)
    "2": 16,   // Venus (DE431)
    "4": 32,   // Mars (DE431)
    "5": 32,   // Jupiter (DE431)
    "6": 32,   // Saturn (DE431)
    "7": 32,   // Uranus (DE431)
    "8": 32,   // Neptune (DE431)
    "9": 32,   // Pluto (DE431)
    "2000001": 100,  // Ceres (EPM)
    "2000002": 100,  // Pallas (EPM)
    "2000004": 100,  // Vesta (EPM)
    "2090377": 100,  // Sedna (EPM)
    "2136199": 100   // Eris (EPM)
  }
}
```

**Преимущества**:
- ✅ Максимальная точность для внутренних объектов (EPM LLR)
- ✅ Максимальная детализация для планет (JPL DE431)
- ✅ Доступ к уникальным телам (EPM asteroids/TNO)
- ✅ Оптимальный размер файла

**Применение**: Научные расчёты, астрологические программы с полным покрытием

---

### Профиль 2: "DE431 Native" (научный стандарт)

```json
{
  "profile": "de431_native",
  "source": "de431",
  "intervals": {
    "1": 8, "2": 16, "3": 16, "4": 32,
    "5": 32, "6": 32, "7": 32, "8": 32,
    "9": 32, "10": 16, "301": 4, "399": 4
  }
}
```

**Преимущества**:
- ✅ Научный стандарт NASA JPL
- ✅ Высокая точность (sub-meter до meter)
- ✅ Длинное временное покрытие (30,390 лет)
- ✅ Однородный источник данных

**Применение**: Научные исследования, длинные временные интервалы

---

### Профиль 3: "EPM2021 Native" (российский стандарт)

```json
{
  "profile": "epm2021_native",
  "source": "epm2021",
  "intervals": {
    "1": 5, "2": 20, "3": 2, "4": 50,
    "5": 100, "6": 300, "7": 400, "8": 500,
    "9": 600, "10": 2, "301": 2, "399": 2,
    "2000001": 100, "2000002": 100, "2000004": 100,
    "2090377": 100, "2136199": 100, "2136472": 100
  }
}
```

**Преимущества**:
- ✅ Улучшенные LLR данные для Луны
- ✅ Высокая детализация внутренних объектов (2 дня)
- ✅ Уникальные тела (asteroids, TNO, dwarf planets)
- ✅ 22 тела в одном источнике

**Применение**: Луна и внутренние планеты (1788-2215 AD), астрология с астероидами

---

### Профиль 4: "Minimal Astrology" (минимальный)

```json
{
  "profile": "minimal_astrology",
  "source": "de431",
  "bodies": [10, 301, 1, 2, 3, 4, 5, 6, 7, 8, 9],
  "interval": 16  // uniform для простоты
}
```

**Преимущества**:
- ✅ Минимальный размер файла (~20-30 MB)
- ✅ Быстрая конвертация
- ✅ Основные 11 тел

**Применение**: Базовые астрологические программы, мобильные приложения

---

## Оценка размеров файлов

### DE431 (12 bodies, 13,200 years, -13200 to +1)

| Body    | Interval | Records   | Size (Type 2)  |
|---------|----------|-----------|----------------|
| Mercury | 8d       | 602,681   | ~7.2 MB        |
| Venus   | 16d      | 301,341   | ~3.6 MB        |
| EMB     | 16d      | 301,341   | ~3.6 MB        |
| Moon    | 4d       | 1,205,361 | ~14.5 MB       |
| Mars    | 32d      | 150,671   | ~1.8 MB        |
| Jupiter | 32d      | 150,671   | ~1.8 MB        |
| Saturn  | 32d      | 150,671   | ~1.8 MB        |
| Uranus  | 32d      | 150,671   | ~1.8 MB        |
| Neptune | 32d      | 150,671   | ~1.8 MB        |
| Pluto   | 32d      | 150,671   | ~1.8 MB        |
| Sun     | 16d      | 301,341   | ~3.6 MB        |
| Earth   | 4d       | 1,205,361 | ~14.5 MB       |
| **ИТОГО** |        |           | **~58 MB**     |

### EPM2021 (22 bodies, 427 years, 1788-2215 AD)

| Body Group      | Count | Interval | Records | Size (Type 20) |
|-----------------|-------|----------|---------|----------------|
| Inner (2d)      | 4     | 2d       | 78,000  | ~6.8 MB        |
| Mercury (5d)    | 1     | 5d       | 31,200  | ~1.7 MB        |
| Venus (20d)     | 1     | 20d      | 7,800   | ~0.4 MB        |
| Mars (50d)      | 1     | 50d      | 3,120   | ~0.2 MB        |
| Jupiter (100d)  | 1     | 100d     | 1,560   | ~0.1 MB        |
| Outer giants    | 3     | 300-600d | 520-260 | ~0.3 MB        |
| Asteroids (5)   | 5     | 100d     | 1,560   | ~0.5 MB        |
| TNO/dwarf (4)   | 4     | 100d     | 1,560   | ~0.4 MB        |
| Pluto-Charon    | 1     | 5d       | 31,200  | ~1.7 MB        |
| **ИТОГО**       | 22    |          |         | **~12 MB**     |

---

## Рекомендации по выбору

### Для научных расчётов
→ **DE431 Native** или **Hybrid Optimal**
- Высокая точность
- Длинное временное покрытие
- Однородные данные

### Для астрологии (классическая)
→ **Minimal Astrology** или **DE431 Native**
- 11 основных тел (Sun-Pluto + Moon + Earth)
- Компактный размер
- Достаточная точность

### Для астрологии (расширенная)
→ **EPM2021 Native** или **Hybrid Optimal**
- Астероиды (Ceres, Pallas, Vesta)
- TNO (Sedna, Eris, Makemake)
- Улучшенные данные для Луны

### Для исследований Луны
→ **EPM2021** с интервалом **2 дня**
- Улучшенные LLR данные
- Высокая детализация (78,000 записей за 427 лет)
- Точность ~20 км

### Для внешних планет/долгосрочных прогнозов
→ **DE431 Native**
- 30,390 лет покрытия
- Детальный интервал 32 дня (vs 300-600 дней EPM)
- Научная точность NASA

---

## Использование в universal_converter.py

```python
# Пример 1: Hybrid optimal с точными интервалами
python tools/universal_converter.py \
  --config tools/universal_converter_config.json \
  --profile hybrid_optimal \
  --output data/ephemerides/hybrid_optimal.eph

# Пример 2: EPM2021 с нативными интервалами
python tools/universal_converter.py \
  --source epm2021 \
  --bodies 1,2,3,4,5,6,7,8,9,10,301,399,2000001,2090377,2136199 \
  --intervals 5,20,2,50,100,300,400,500,600,2,2,2,100,100,100 \
  --output data/ephemerides/epm2021_native.eph

# Пример 3: DE431 минимальный (uniform 16d)
python tools/universal_converter.py \
  --source de431_part1 \
  --bodies 1,2,3,4,5,6,7,8,9,10,301 \
  --interval 16.0 \
  --output data/ephemerides/de431_minimal.eph
```

---

## Почему документация была неточной?

### JPL DE431 документация vs реальность

| Тело    | Документация | Реальность (calceph) | Разница |
|---------|--------------|----------------------|---------|
| Moon    | 8 дней       | **4 дня**            | -50%    |
| Earth   | 32 дня       | **4 дня**            | -87.5%  |
| EMB     | 32 дня       | **16 дней**          | -50%    |
| Uranus  | 64 дня       | **32 дня**           | -50%    |
| Neptune | 64 дня       | **32 дня**           | -50%    |
| Pluto   | 64 дня       | **32 дня**           | -50%    |

**Причина**: Документация JPL описывает **рекомендуемые** интервалы для пользовательских расчётов, а не **нативные** интервалы хранения в SPK файлах.

### EPM2021 документация vs реальность

**Документация ИПА РАН**: "Основные планеты: аналогично JPL DE440"

**Реальность**:
- Внутренние тела: **2 дня** (гораздо детальнее!)
- Внешние планеты: **300-600 дней** (гораздо крупнее!)
- Type 20 (Hermite) vs Type 2 (Chebyshev) → разные стратегии оптимизации

**Причина**: EPM использует Type 20 (Modified Difference Array), который позволяет большие интервалы без потери точности для медленных объектов.

---

## Заключение

✅ **ТОЧНЫЕ нативные интервалы извлечены** через CALCEPH inspector
✅ **Hybrid Optimal профиль рекомендуется** для максимальной точности
✅ **EPM2021 лучше для Луны и внутренних объектов** (2 дня vs 4-16 дней)
✅ **DE431 лучше для планет и долгосрочных расчётов** (32 дня vs 100-600 дней)
✅ **Размеры файлов оптимальны** при использовании нативных интервалов

**Инструмент**: `vendor/calceph-4.0.1/install/bin/calceph_inspector.exe` — единственный надёжный источник точных интервалов! 🎯
